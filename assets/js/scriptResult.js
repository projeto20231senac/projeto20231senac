//////////////////////////////JSON de índices de atualização das contribuições pela inflação///////////////////
const indices = [{"competencia":"1994-07","indice":"10.440883"},{"competencia":"1994-07","indice":"9.84246"},{"competencia":"1994-07","indice":"9.332879"},{"competencia":"1994-07","indice":"9.194057"},{"competencia":"1994-07","indice":"9.026169"},{"competencia":"1994-07","indice":"8.740359"},{"competencia":"1994-07","indice":"8.553047"},{"competencia":"1994-07","indice":"8.412552"},{"competencia":"1994-07","indice":"8.330087"},{"competencia":"1994-07","indice":"8.214263"},{"competencia":"1994-07","indice":"8.059524"},{"competencia":"1994-07","indice":"7.857583"},{"competencia":"1994-07","indice":"7.717134"},{"competencia":"1994-07","indice":"7.531846"},{"competencia":"1994-07","indice":"7.455799"},{"competencia":"1994-07","indice":"7.369575"},{"competencia":"1994-07","indice":"7.267823"},{"competencia":"1994-07","indice":"7.159714"},{"competencia":"1994-07","indice":"7.043494"},{"competencia":"1994-07","indice":"6.942146"},{"competencia":"1994-07","indice":"6.893197"},{"competencia":"1994-07","indice":"6.873268"},{"competencia":"1994-07","indice":"6.825488"},{"competencia":"1994-07","indice":"6.712712"},{"competencia":"1994-07","indice":"6.631808"},{"competencia":"1994-07","indice":"6.5603"},{"competencia":"1994-07","indice":"6.560033"},{"competencia":"1994-07","indice":"6.551519"},{"competencia":"1994-07","indice":"6.537137"},{"competencia":"1994-07","indice":"6.518886"},{"competencia":"1994-07","indice":"6.462016"},{"competencia":"1994-08","indice":"6.361507"},{"competencia":"1994-08","indice":"6.334896"},{"competencia":"1994-08","indice":"6.26226"},{"competencia":"1994-08","indice":"6.225526"},{"competencia":"1994-08","indice":"6.206908"},{"competencia":"1994-08","indice":"6.163763"},{"competencia":"1994-08","indice":"6.15822"},{"competencia":"1994-08","indice":"6.15822"},{"competencia":"1994-08","indice":"6.122096"},{"competencia":"1994-08","indice":"6.101352"},{"competencia":"1994-08","indice":"6.051127"},{"competencia":"1994-08","indice":"6.009662"},{"competencia":"1994-08","indice":"5.957243"},{"competencia":"1994-08","indice":"5.956049"},{"competencia":"1994-08","indice":"5.942379"},{"competencia":"1994-08","indice":"5.942379"},{"competencia":"1994-08","indice":"5.928745"},{"competencia":"1994-08","indice":"5.912186"},{"competencia":"1994-08","indice":"5.912186"},{"competencia":"1994-08","indice":"5.912186"},{"competencia":"1994-08","indice":"5.912186"},{"competencia":"1994-08","indice":"5.912186"},{"competencia":"1994-08","indice":"5.912186"},{"competencia":"1994-08","indice":"5.854817"},{"competencia":"1994-08","indice":"5.788241"},{"competencia":"1994-08","indice":"5.542173"},{"competencia":"1994-08","indice":"5.434569"},{"competencia":"1994-08","indice":"5.432941"},{"competencia":"1994-08","indice":"5.432941"},{"competencia":"1994-08","indice":"5.378082"},{"competencia":"1994-08","indice":"5.293914"},{"competencia":"1994-09","indice":"5.218248"},{"competencia":"1994-09","indice":"5.142647"},{"competencia":"1994-09","indice":"5.047258"},{"competencia":"1994-09","indice":"4.922712"},{"competencia":"1994-09","indice":"4.862901"},{"competencia":"1994-09","indice":"4.813797"},{"competencia":"1994-09","indice":"4.804669"},{"competencia":"1994-09","indice":"4.796036"},{"competencia":"1994-09","indice":"4.789808"},{"competencia":"1994-09","indice":"4.757929"},{"competencia":"1994-09","indice":"4.71409"},{"competencia":"1994-09","indice":"4.609911"},{"competencia":"1994-09","indice":"4.527504"},{"competencia":"1994-09","indice":"4.496481"},{"competencia":"1994-09","indice":"4.479905"},{"competencia":"1994-09","indice":"4.462498"},{"competencia":"1994-09","indice":"4.428838"},{"competencia":"1994-09","indice":"4.407251"},{"competencia":"1994-09","indice":"4.392311"},{"competencia":"1994-09","indice":"4.35745"},{"competencia":"1994-09","indice":"4.308764"},{"competencia":"1994-09","indice":"4.28989"},{"competencia":"1994-09","indice":"4.228159"},{"competencia":"1994-09","indice":"4.160754"},{"competencia":"1994-09","indice":"4.123637"},{"competencia":"1994-09","indice":"4.108031"},{"competencia":"1994-09","indice":"4.049315"},{"competencia":"1994-09","indice":"4.018769"},{"competencia":"1994-09","indice":"4.011555"},{"competencia":"1994-09","indice":"4.003948"},{"competencia":"1994-10","indice":"3.996751"},{"competencia":"1994-10","indice":"3.99236"},{"competencia":"1994-10","indice":"3.964608"},{"competencia":"1994-10","indice":"3.921082"},{"competencia":"1994-10","indice":"3.854016"},{"competencia":"1994-10","indice":"3.776604"},{"competencia":"1994-10","indice":"3.689532"},{"competencia":"1994-10","indice":"3.594631"},{"competencia":"1994-10","indice":"3.449411"},{"competencia":"1994-10","indice":"3.259073"},{"competencia":"1994-10","indice":"3.173397"},{"competencia":"1994-10","indice":"3.105992"},{"competencia":"1994-10","indice":"3.057385"},{"competencia":"1994-10","indice":"3.007463"},{"competencia":"1994-10","indice":"2.995179"},{"competencia":"1994-10","indice":"3.015385"},{"competencia":"1994-10","indice":"3.03664"},{"competencia":"1994-10","indice":"3.04273"},{"competencia":"1994-10","indice":"3.023977"},{"competencia":"1994-10","indice":"2.992557"},{"competencia":"1994-10","indice":"2.979444"},{"competencia":"1994-10","indice":"2.965214"},{"competencia":"1994-10","indice":"2.947527"},{"competencia":"1994-10","indice":"2.924135"},{"competencia":"1994-10","indice":"2.912774"},{"competencia":"1994-10","indice":"2.896269"},{"competencia":"1994-10","indice":"2.884442"},{"competencia":"1994-10","indice":"2.872947"},{"competencia":"1994-10","indice":"2.858665"},{"competencia":"1994-10","indice":"2.837939"},{"competencia":"1994-10","indice":"2.82382"},{"competencia":"1994-11","indice":"2.81903"},{"competencia":"1994-11","indice":"2.814246"},{"competencia":"1994-11","indice":"2.801914"},{"competencia":"1994-11","indice":"2.778021"},{"competencia":"1994-11","indice":"2.762279"},{"competencia":"1994-11","indice":"2.750178"},{"competencia":"1994-11","indice":"2.730245"},{"competencia":"1994-11","indice":"2.705625"},{"competencia":"1994-11","indice":"2.686817"},{"competencia":"1994-11","indice":"2.689776"},{"competencia":"1994-11","indice":"2.688968"},{"competencia":"1994-11","indice":"2.688968"},{"competencia":"1994-11","indice":"2.684942"},{"competencia":"1994-11","indice":"2.669463"},{"competencia":"1994-11","indice":"2.655121"},{"competencia":"1994-11","indice":"2.644546"},{"competencia":"1994-11","indice":"2.634534"},{"competencia":"1994-11","indice":"2.628491"},{"competencia":"1994-11","indice":"2.621408"},{"competencia":"1994-11","indice":"2.618268"},{"competencia":"1994-11","indice":"2.614871"},{"competencia":"1994-11","indice":"2.616696"},{"competencia":"1994-11","indice":"2.613827"},{"competencia":"1994-11","indice":"2.614345"},{"competencia":"1994-11","indice":"2.610171"},{"competencia":"1994-11","indice":"2.598996"},{"competencia":"1994-11","indice":"2.588124"},{"competencia":"1994-11","indice":"2.572174"},{"competencia":"1994-11","indice":"2.55964"},{"competencia":"1994-11","indice":"2.54893"},{"competencia":"1994-12","indice":"2.53776"},{"competencia":"1994-12","indice":"2.531184"},{"competencia":"1994-12","indice":"2.524617"},{"competencia":"1994-12","indice":"2.51682"},{"competencia":"1994-12","indice":"2.508786"},{"competencia":"1994-12","indice":"2.494071"},{"competencia":"1994-12","indice":"2.487855"},{"competencia":"1994-12","indice":"2.480416"},{"competencia":"1994-12","indice":"2.469788"},{"competencia":"1994-12","indice":"2.446063"},{"competencia":"1994-12","indice":"2.429303"},{"competencia":"1994-12","indice":"2.416976"},{"competencia":"1994-12","indice":"2.40471"},{"competencia":"1994-12","indice":"2.38942"},{"competencia":"1994-12","indice":"2.366703"},{"competencia":"1994-12","indice":"2.345361"},{"competencia":"1994-12","indice":"2.331834"},{"competencia":"1994-12","indice":"2.326944"},{"competencia":"1994-12","indice":"2.323459"},{"competencia":"1994-12","indice":"2.3119"},{"competencia":"1994-12","indice":"2.303149"},{"competencia":"1994-12","indice":"2.296493"},{"competencia":"1994-12","indice":"2.281887"},{"competencia":"1994-12","indice":"2.274835"},{"competencia":"1994-12","indice":"2.270291"},{"competencia":"1994-12","indice":"2.257881"},{"competencia":"1994-12","indice":"2.244411"},{"competencia":"1994-12","indice":"2.235021"},{"competencia":"1994-12","indice":"2.229894"},{"competencia":"1994-12","indice":"2.228109"},{"competencia":"1994-12","indice":"2.224551"},{"competencia":"1995-01","indice":"2.219226"},{"competencia":"1995-01","indice":"2.211044"},{"competencia":"1995-01","indice":"2.205743"},{"competencia":"1995-01","indice":"2.186508"},{"competencia":"1995-01","indice":"2.171306"},{"competencia":"1995-01","indice":"2.156001"},{"competencia":"1995-01","indice":"2.140375"},{"competencia":"1995-01","indice":"2.131214"},{"competencia":"1995-01","indice":"2.133561"},{"competencia":"1995-01","indice":"2.135057"},{"competencia":"1995-01","indice":"2.136553"},{"competencia":"1995-01","indice":"2.125078"},{"competencia":"1995-01","indice":"2.105699"},{"competencia":"1995-01","indice":"2.084232"},{"competencia":"1995-01","indice":"2.071803"},{"competencia":"1995-01","indice":"2.052509"},{"competencia":"1995-01","indice":"2.041485"},{"competencia":"1995-01","indice":"2.028102"},{"competencia":"1995-01","indice":"2.013597"},{"competencia":"1995-01","indice":"2.002188"},{"competencia":"1995-01","indice":"1.997793"},{"competencia":"1995-01","indice":"1.997793"},{"competencia":"1995-01","indice":"1.989435"},{"competencia":"1995-01","indice":"1.980527"},{"competencia":"1995-01","indice":"1.97421"},{"competencia":"1995-01","indice":"1.963014"},{"competencia":"1995-01","indice":"1.953064"},{"competencia":"1995-01","indice":"1.943151"},{"competencia":"1995-01","indice":"1.935599"},{"competencia":"1995-01","indice":"1.932121"},{"competencia":"1995-01","indice":"1.919841"},{"competencia":"1995-02","indice":"1.909337"},{"competencia":"1995-02","indice":"1.904382"},{"competencia":"1995-02","indice":"1.896232"},{"competencia":"1995-02","indice":"1.887733"},{"competencia":"1995-02","indice":"1.875918"},{"competencia":"1995-02","indice":"1.862693"},{"competencia":"1995-02","indice":"1.852689"},{"competencia":"1995-02","indice":"1.839074"},{"competencia":"1995-02","indice":"1.822313"},{"competencia":"1995-02","indice":"1.812885"},{"competencia":"1995-02","indice":"1.80207"},{"competencia":"1995-02","indice":"1.7915"},{"competencia":"1995-02","indice":"1.785253"},{"competencia":"1995-02","indice":"1.780272"},{"competencia":"1995-02","indice":"1.782586"},{"competencia":"1995-02","indice":"1.77974"},{"competencia":"1995-02","indice":"1.774946"},{"competencia":"1995-02","indice":"1.76419"},{"competencia":"1995-02","indice":"1.754706"},{"competencia":"1995-02","indice":"1.742163"},{"competencia":"1995-02","indice":"1.731265"},{"competencia":"1995-02","indice":"1.720252"},{"competencia":"1995-02","indice":"1.706262"},{"competencia":"1995-02","indice":"1.693051"},{"competencia":"1995-02","indice":"1.682951"},{"competencia":"1995-02","indice":"1.678587"},{"competencia":"1995-02","indice":"1.676409"},{"competencia":"1995-02","indice":"1.673396"},{"competencia":"1995-03","indice":"1.665239"},{"competencia":"1995-03","indice":"1.658937"},{"competencia":"1995-03","indice":"1.650189"},{"competencia":"1995-03","indice":"1.64002"},{"competencia":"1995-03","indice":"1.616103"},{"competencia":"1995-03","indice":"1.59757"},{"competencia":"1995-03","indice":"1.573808"},{"competencia":"1995-03","indice":"1.562712"},{"competencia":"1995-03","indice":"1.547393"},{"competencia":"1995-03","indice":"1.535569"},{"competencia":"1995-03","indice":"1.526716"},{"competencia":"1995-03","indice":"1.522903"},{"competencia":"1995-03","indice":"1.515177"},{"competencia":"1995-03","indice":"1.503602"},{"competencia":"1995-03","indice":"1.487092"},{"competencia":"1995-03","indice":"1.47383"},{"competencia":"1995-03","indice":"1.451907"},{"competencia":"1995-03","indice":"1.438241"},{"competencia":"1995-03","indice":"1.431942"},{"competencia":"1995-03","indice":"1.422836"},{"competencia":"1995-03","indice":"1.40903"},{"competencia":"1995-03","indice":"1.402433"},{"competencia":"1995-03","indice":"1.393513"},{"competencia":"1995-03","indice":"1.389211"},{"competencia":"1995-03","indice":"1.388102"},{"competencia":"1995-03","indice":"1.385741"},{"competencia":"1995-03","indice":"1.384777"},{"competencia":"1995-03","indice":"1.382843"},{"competencia":"1995-03","indice":"1.377053"},{"competencia":"1995-03","indice":"1.373758"},{"competencia":"1995-03","indice":"1.36938"},{"competencia":"1995-04","indice":"1.368284"},{"competencia":"1995-04","indice":"1.363374"},{"competencia":"1995-04","indice":"1.367475"},{"competencia":"1995-04","indice":"1.365159"},{"competencia":"1995-04","indice":"1.365565"},{"competencia":"1995-04","indice":"1.365843"},{"competencia":"1995-04","indice":"1.360802"},{"competencia":"1995-04","indice":"1.358356"},{"competencia":"1995-04","indice":"1.354839"},{"competencia":"1995-04","indice":"1.351731"},{"competencia":"1995-04","indice":"1.349298"},{"competencia":"1995-04","indice":"1.348356"},{"competencia":"1995-04","indice":"1.345529"},{"competencia":"1995-04","indice":"1.33977"},{"competencia":"1995-04","indice":"1.320881"},{"competencia":"1995-04","indice":"1.317585"},{"competencia":"1995-04","indice":"1.317585"},{"competencia":"1995-04","indice":"1.313642"},{"competencia":"1995-04","indice":"1.308412"},{"competencia":"1995-04","indice":"1.311689"},{"competencia":"1995-04","indice":"1.309861"},{"competencia":"1995-04","indice":"1.305156"},{"competencia":"1995-04","indice":"1.298149"},{"competencia":"1995-04","indice":"1.288229"},{"competencia":"1995-04","indice":"1.280547"},{"competencia":"1995-04","indice":"1.278629"},{"competencia":"1995-04","indice":"1.278499"},{"competencia":"1995-04","indice":"1.277221"},{"competencia":"1995-04","indice":"1.275688"},{"competencia":"1995-04","indice":"1.276331"},{"competencia":"1995-05","indice":"1.275818"},{"competencia":"1995-05","indice":"1.268967"},{"competencia":"1995-05","indice":"1.253672"},{"competencia":"1995-05","indice":"1.251296"},{"competencia":"1995-05","indice":"1.249171"},{"competencia":"1995-05","indice":"1.246927"},{"competencia":"1995-05","indice":"1.249799"},{"competencia":"1995-05","indice":"1.252935"},{"competencia":"1995-05","indice":"1.249187"},{"competencia":"1995-05","indice":"1.243711"},{"competencia":"1995-05","indice":"1.23925"},{"competencia":"1995-05","indice":"1.228565"},{"competencia":"1995-05","indice":"1.217724"},{"competencia":"1995-05","indice":"1.206265"},{"competencia":"1995-05","indice":"1.188909"},{"competencia":"1995-05","indice":"1.185708"},{"competencia":"1995-05","indice":"1.176063"},{"competencia":"1995-05","indice":"1.166036"},{"competencia":"1995-05","indice":"1.161623"},{"competencia":"1995-05","indice":"1.150576"},{"competencia":"1995-05","indice":"1.143713"},{"competencia":"1995-05","indice":"1.132166"},{"competencia":"1995-05","indice":"1.122289"},{"competencia":"1995-05","indice":"1.108982"},{"competencia":"1995-05","indice":"1.096264"},{"competencia":"1995-05","indice":"1.087132"},{"competencia":"1995-05","indice":"1.079254"},{"competencia":"1995-05","indice":"1.072071"},{"competencia":"1995-05","indice":"1.061457"},{"competencia":"1995-05","indice":"1.043613"},{"competencia":"1995-05","indice":"1.032868"},{"competencia":"1995-06","indice":"1.028242"},{"competencia":"1995-06","indice":"1.021907"},{"competencia":"1995-06","indice":"1.028075"},{"competencia":"1995-06","indice":"1.031271"},{"competencia":"1995-06","indice":"1.034582"},{"competencia":"1995-06","indice":"1.029741"},{"competencia":"1995-06","indice":"1.025845"},{"competencia":"1995-06","indice":"1.018814"},{"competencia":"1995-06","indice":"1.014149"},{"competencia":"1995-06","indice":"1.0064"}]



//////////////////////script///////////////////////////
const anoAtual = new Date().getFullYear(); //pega o ano atual
var idade = localStorage.getItem("idade"); //pega o localstorage da idade
var idadeAposentadoria = localStorage.getItem("idadeAposentadoria"); //pega o localstorage da idade de aposentadoria
const remuneracoes = JSON.parse(localStorage.getItem('json')); //pega o localstorage dos dados do json
var genero = localStorage.getItem("gender"); //pega o localstorage do sexo informado pelo usuário


//recupera o genero
var gender = document.getElementById("gender");
gender.innerText = genero;

//recupera a idade atual
var currentAge = document.getElementById("currentAge");
currentAge.innerText = idade;


//código para calcular quantos meses de contribuição foram lidos no JSON
let count = 0;
for (let i = 0; i < remuneracoes.length; i++) {
  if (remuneracoes[i].hasOwnProperty("competencia")) {
    count++;
  }
}
var mesesContribuicao = document.getElementById("calculatedCNIS");
const anos = parseInt(count / 12);
const meses = count % 12;

if (anos === 1) {
  mesesContribuicao.innerText = `${anos} ano`;
} else if (anos > 1) {
  mesesContribuicao.innerText = `${anos} anos`;
}
if (anos > 0 && meses > 0) {
  mesesContribuicao.innerText += ` e `;
}
if (meses === 1) {
  mesesContribuicao.innerText += `${meses} mês`;
} else if (meses > 1) {
  mesesContribuicao.innerText += `${meses} meses`;
}
if (anos === 0 && meses === 0) {
  mesesContribuicao.innerText = `Menos de 1 mês`;
}

//calcula a média de contribuição em R$
const valoresRemuneracao = remuneracoes.map(obj => parseFloat(obj.remuneracao.replace(".","").replace(",",".")));
for (i = 0; i <= valoresRemuneracao.length - 1; i++){
  valoresRemuneracao[i] = valoresRemuneracao[i] * parseFloat(indices[i].indice)
}

const mediaRemuneracoes = valoresRemuneracao.reduce((total, valores) => total + valores,0) / valoresRemuneracao.length;


const mediaRemuneracoesEmReais = mediaRemuneracoes.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
var mediaINSS = document.getElementById("averageINSS");
mediaINSS.innerText = mediaRemuneracoesEmReais;

//recupera a idade que deseja se aposentar
var idadeAposentadoriaResult = document.getElementById("selectedYear");
idadeAposentadoriaResult.innerText = `${idadeAposentadoria} anos`;

//calcula o ano de aposentadoria
var calculatedYear = document.getElementById("calculatedYear");
calculatedYear.innerText = parseInt(anoAtual) + (parseInt(idadeAposentadoria) - idade);

//funcao para retornar o salário
var salario = document.getElementById("salary")
var mediaSalarios = ((valoresRemuneracao.reduce((total, valores) => total + valores,0) + valoresRemuneracao[valoresRemuneracao.length-1]* ((parseInt(idadeAposentadoria) - idade) * 12))/(valoresRemuneracao.length + (parseInt(idadeAposentadoria) - idade) * 12)).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
var auxCalculoSalario = (valoresRemuneracao.reduce((total, valores) => total + valores,0) + valoresRemuneracao[valoresRemuneracao.length-1]*((parseInt(idadeAposentadoria) - idade) * 12))/(valoresRemuneracao.length + (parseInt(idadeAposentadoria) - idade) * 12)

if(genero == "masculino" && ((valoresRemuneracao.length)/12+(parseInt(idadeAposentadoria) - idade) < 20)){
    alert("Não pode se aposentar com essa idade")
    salario.innerText = "Não calculado pois não poderá se aposentar"

  }else if (genero == "masculino" && (valoresRemuneracao.length/12+(parseInt(idadeAposentadoria) - idade) >= 20)){
    var mediaSalarios = auxCalculoSalario * (0.6 + 0.02 * (parseInt(idadeAposentadoria) - 20))
    if(mediaSalarios < 1302){
      mediaSalarios = 1302
    }else if(mediaSalarios > 7507.49){
      mediaSalarios = 7507.49
      alert("Seu salário é o máximo permitido")
    }
    salario.innerText = mediaSalarios.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })

  }else if(genero == "feminino" && (valoresRemuneracao.length/12+(parseInt(idadeAposentadoria) - idade) < 15)){
    alert("Não pode se aposentar com essa idade")
    salario.innerText = "Não calculado pois não poderá se aposentar"

  }else{
    var mediaSalarios = auxCalculoSalario * (0.6 + 0.02 * (parseInt(idadeAposentadoria) - 15))
    if(mediaSalarios < 1302){
      mediaSalarios = 1302
    }else if(mediaSalarios > 7507.49){
      mediaSalarios = 7507.49
      alert("Seu salário é o máximo permitido")

    }
    salario.innerText = mediaSalarios.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
  }

  //testes
  console.log((valoresRemuneracao.length/12+(parseInt(idadeAposentadoria) - idade) >= 20))


//ao clicar em reiniciar
const btnLimpar = document.getElementById("restart");
btnLimpar.addEventListener("click", function() {
  localStorage.clear();
});
